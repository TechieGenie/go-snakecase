machine:
  services:
    - docker

dependencies:
  override:
    - docker pull segment/golang:latest

test:
  override:
    - >
      docker run
      $(env | grep -E '^CIRCLE_|^DOCKER_|^CIRCLE$|^CI$' | sed 's/^/--env /g' | tr "\\n" " ")
      --rm
      --tty
      --interactive
      --name go
      --volume /var/run/docker.sock:/run/docker.sock
      --volume ${PWD}:/go/src/${CIRCLE_REPOSITORY_URL#https://}
      --workdir /go/src/${CIRCLE_REPOSITORY_URL#https://}
      segment/golang:latest
